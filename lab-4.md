# Lab 4 - Develop a multi-agent system

## Estimated time: 30 minutes
## Lab scenario
In this lab, you will be creating a multi-agent system consisting of 4 agents working together to generate reports about health plan documents. You will build these 4 AI Agents:
- **Search Agent** - This agent will search an Azure AI Search index for information about specific health plan policies.
- **Report Agent** - This agent will generate a detailed report about the health plan policy based on the information returned from the Search Agent.
- **Validation Agent** - This agent will validate that the generated report meets specified requirements. In our case, making sure that the report contains information about coverage exclusions.
- **Orchestrator Agent** - This agent will act as an orchestrator that manages the communication between the Search Agent, Report Agent, and Validation Agent.

    ![](./media/download1upd.png)

Orchestration is a key part of multi-agentic systems since the agents that we create need to be able to communicate with each other in order to accomplish the objective.

We'll use the Azure AI Agent Service to create the Search, Report, and Validation agents. However, to create the Orchestrator Agent, we'll use Semantic Kernel. The Semantic Kernel library provides out-of-the-box functionality for orchestrating multi-agent systems.

## Lab Objective
In this lab, you will complete the following tasks:

- Task 1: Create the Search, Report, and Validation Agents.

## Task 1: Create the Search, Report, and Validation Agents

In this task, you will create the Search, Report, and Validation Agents to retrieve, generate, and validate health plan reports. These agents will work together to ensure accuracy and compliance with requirements. Each agent plays a distinct role in retrieving, compiling, and ensuring the accuracy of the reports.

1. Open the **Lab 4 - Develop A Mult-Agent System.ipynb** file, this **Lab 4 - Develop A Mult-Agent System.ipynb** notebook guides you through developing a multi-agent system with Search, Report, Validation, and Orchestrator Agents to generate and validate health plan reports. Each agent plays a distinct role in retrieving, compiling, and ensuring the accuracy of the reports.

   ![](./media/ag83.png)

1. Select the **Select kernel (1)** setting available in the top right corner and select **venv (Python 3.12.1) (2)** from the list.

   ![](./media/ag84.png)

1. Run this cell to develop a **multi-agent system** that integrates Azure AI Search, GPT-4o, and Semantic Kernel for intelligent task execution. This setup enables multiple AI agents to collaborate on retrieving information, generating responses, and handling complex queries.

   ![](./media/ag85.png)

1. Run this cell to create the **Search Agent**, which retrieves health plan details from Azure AI Search using GPT-4o. This agent enables efficient retrieval of structured information from health plan documents.

   ![](./media/ag86.png)

1. Run this cell to create the **Report Agent**, which generates detailed reports on health plans using GPT-4o. This agent enhances documentation by providing structured insights, coverage details, and exclusions for various plans.

   ![](./media/ag87.png)

1. Run this cell to create the **Validation Agent**, which ensures that reports generated by the Report Agent meet quality standards, specifically checking for coverage exclusions.

   ![](./media/ag88.png)
   
1. Finally observe the output.

   ![](./media/lab2-26.png)
   
1. **Create a multi-agent system** : When you run the below cell, you will see a chat box pop up at the top of VS Code asking you to input the name of a health plan.
  
   ![](./media/ag89.png)  
  
1. If you recall, we uploaded two health plans to the search index. Type one of the following health plans in the box and press enter to begin running the multi-agent system:

    - Northwind Health Standard
    - Northwind Health Plus

        ![](./media/download1.png)
      
    > **Note**: After the successful run of the cell you will recieve the following outcome.

    ```
    Orchestrator Agent is starting...
    Calling SearchAgent...
    SearchAgent completed successfully.
    Calling ReportAgent...
    ReportAgent completed successfully.
    Calling ValidationAgent...
    ValidationAgent completed successfully.
    The report for Northwind Plus has been generated. Please check the Northwind Plus Report.md file for the report.
    Orchestrator Agent is starting...
    ```

## Review

In this lab, you have accomplished the following:
- Created the Search, Report, and Validation Agents.

## You have successfully completed the lab.
